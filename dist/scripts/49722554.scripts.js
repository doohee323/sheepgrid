"use strict";var config={url:"http://sheeprails.herokuapp.com",server:"rails",centers:{}};angular.module("sheepgridApp",["ngResource","ngGrid"]).constant("config",config).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{redirectTo:"/centers"}).when("/centers",{controller:"CentersCtrl",templateUrl:"./views/centers.html"}).when("/center/:id",{controller:"CentersCtrl",templateUrl:"./views/centers.html"}).when("/regions/:id",{controller:"RegionsCtrl",templateUrl:"/views/regions.html"}).otherwise({redirectTo:"/centers"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("sheepgridApp").controller("CentersCtrl",["$scope","$location","$routeParams","$timeout","config","CenterService","CommongridService",function(a,b,c,d,e,f,g){a.$location=b,a.cellValue;var h='<div class="ngSelectionCell"><input tabindex="-1" class="ngSelectionCheckbox" type="checkbox" ng-checked="row.selected" /></div>',i='<input style="width: 90%" step="any" type="string" ng-class="\'colt\' + col.index" ng-input="COL_FIELD" ng-blur="updateEntity(col, row, cellValue)" ng-model=\'cellValue\'/>';a.gridCenter={data:"uip_center",multiSelect:!1,enableCellSelection:!0,enableCellEditOnFocus:!0,enableRowSelection:!0,enablePinning:!0,enableSorting:!0,columnDefs:[{field:"CHK",displayName:"chk",width:50,cellTemplate:h,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"status",displayName:"CRUD",width:50,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"link",displayName:"link",width:80,cellTemplate:"<div><button ng-click=\"goTo('/regions/', row)\">to region</button></div>"},{field:"id",displayName:"id",enableCellEdit:!1},{field:"code",displayName:"code",editableCellTemplate:i},{field:"name",displayName:"name",editableCellTemplate:i},{field:"chief",displayName:"chief",editableCellTemplate:i},{field:"address",displayName:"address",editableCellTemplate:i},{field:"phone",displayName:"phone",editableCellTemplate:i}],selectedItems:[],afterSelectionChange:function(b){a.newRegion=b.entity}},g.init(a,d,e,f,"gridCenter")}]),angular.module("sheepgridApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.goTo=function(c,d){var e=c;"/"==c||(d?e+=d.entity.id:a.uip_center[0]&&(e+=a.uip_center[0].id)),b.path(e)}}]),angular.module("sheepgridApp").directive("commbutton",["$compile",function(a){var b=function(a,b,c){var d='<button id="'+a+b+'" class="btn btn-primary" type="button" ng-click="'+a+"Data";return d+=c?"("+c+')"':'()"',d+=">"+a+"</button>"},c=function(c,d,e){d.html(b(e.type,e.data,e.dataset)).show(),a(d.contents())(c)};return{restrict:"E",link:c,replace:!0}}]),angular.module("sheepgridApp").directive("ngBlur",function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.ngBlur)})}}),angular.module("sheepgridApp").service("CommongridService",function(){var a=null,b=null,c=null;this.init=function(d,e,f,g,h,i){function j(c){var e={};c&&(e=c),g.get(e,function(c){for(var e=0;e<c[b].length;e++)c[b][e].status="R";d[a]=c[b]})}a=d[h].data,b=a+"s",c=i,d.updateEntity=function(b,c,e){var f=d[a][c.rowIndex],g=d[a][c.rowIndex].status;g&&"I"==g||f[b.colDef.field]!=e&&(d[a][c.rowIndex].status="U"),c.entity[b.field]=e},j(c),d.$on("ngGridEventData",function(){d[h].selectRow&&(d[h].selectRow(0,!0),$(".ngViewport").focus())}),d.retrieveData=function(a){c&&(a=c),j(a)},d.insertData=function(){var b=d[h].columnDefs,f=k(b);c&&(f=l(c,f)),f.status="I",d[a].unshift(f);var g=function(){d[h].selectRow(0,!0)};e(g,500)},d.deleteData=function(){for(var b=d[h].selectedItems[0].id,c=0;c<d[a].length;c++)d[a][c].id==b&&("I"==d[a][c].status?d[a].splice(c,1):d[a][c].status="D")},d.initData=function(){for(var b=d[h].selectedItems[0].id,c=0;c<d[a].length;c++)if(d[a][c].id==b){for(var e=0;e<Object.keys(d[a][c]).length;e++)d[a][c][Object.keys(d[a][c])[e]]=null;break}},d.saveData=function(){for(var b=d[a],c=0;c<b.length;c++){var e=b[c].status,h=c;delete b[c].status;var i={};"I"==e?(i[a]=b[c],"spring"==f.server&&(i=b[c]),g.save(i,function(b){d[a][0].id=b[a].id})):"U"==e?(i[a]=b[c],i.id=b[c].id,"spring"==f.server&&(i=i[a]),g.update(i,function(b){d[a][h]=b[a]})):"D"==e&&g.delete({id:b[c].id},function(){d[a].splice(h,1)}),d[a][c].status="R"}};var k=function(a){for(var b=angular.copy(a),c={},d=0;d<b.length;d++)b[d].field&&"link"!=b[d].field&&"CHK"!=b[d].field&&(c[b[d].field]=null);return c},l=function(a,b){for(var c=0;c<Object.keys(a).length;c++)b[Object.keys(a)[c]]=a[Object.keys(a)[c]];return b}}}),angular.module("sheepgridApp").factory("CenterService",["$resource","config",function(a,b){return a(b.url+"/uip_centers/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("sheepgridApp").controller("RegionsCtrl",["$scope","$location","$routeParams","$timeout","config","RegionService","CommongridService",function(a,b,c,d,e,f,g){a.$location=b,a.cellValue;var h='<div class="ngSelectionCell"><input tabindex="-1" class="ngSelectionCheckbox" type="checkbox" ng-checked="row.selected" /></div>',i='<input style="width: 90%" step="any" type="string" ng-class="\'colt\' + col.index" ng-input="COL_FIELD" ng-blur="updateEntity(col, row, cellValue)" ng-model=\'cellValue\'/>';a.gridRegion={data:"uip_region",multiSelect:!1,enableCellSelection:!0,enableCellEditOnFocus:!0,enableRowSelection:!0,enablePinning:!0,enableSorting:!0,columnDefs:[{field:"CHK",displayName:"chk",width:50,cellTemplate:h,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"status",displayName:"CRUD",width:50,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"uip_center_id",displayName:"uip_center_id",enableCellEdit:!1},{field:"id",displayName:"id",enableCellEdit:!1},{field:"code",displayName:"code",editableCellTemplate:i},{field:"region_code",displayName:"region_code",editableCellTemplate:i},{field:"name",displayName:"name",editableCellTemplate:i},{field:"chief",displayName:"chief",editableCellTemplate:i},{field:"address",displayName:"address",editableCellTemplate:i}],selectedItems:[],afterSelectionChange:function(b){a.newRegion=b.entity}};var j={uip_center_id:c.id};g.init(a,d,e,f,"gridRegion",j),a.goHomeData=function(){var a="/centers";b.path(a)}}]),angular.module("sheepgridApp").factory("RegionService",["$resource","config",function(a,b){return a(b.url+"/uip_regions/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("sheepgridApp").filter("agoText",function(){return function(a){return moment.lang("en"),moment(a).fromNow()}});