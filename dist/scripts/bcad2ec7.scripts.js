"use strict";var config={url:"http://sheeprails.herokuapp.com",server:"rails",centers:{},socketLogined:!1,socketUrl:"http://sheepsocket-43181.usw1.actionbox.io:5000/ui_centers"};angular.module("sheepgridApp",["ngResource","ngGrid"]).constant("config",config).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{redirectTo:"/centers"}).when("/centers",{controller:"CentersCtrl",templateUrl:"./views/centers.html"}).when("/center/:id",{controller:"CentersCtrl",templateUrl:"./views/centers.html"}).when("/regions/:id",{controller:"RegionsCtrl",templateUrl:"/views/regions.html"}).otherwise({redirectTo:"/centers"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("sheepgridApp").controller("CentersCtrl",["$scope","$location","$routeParams","$timeout","config","CenterService","CommongridService",function(a,b,c,d,e,f,g){a.$location=b,a.cellValue;var h='<div class="ngSelectionCell"><input tabindex="-1" class="ngSelectionCheckbox" type="checkbox" ng-checked="row.selected" /></div>',i='<input style="width: 90%" step="any" type="string" ng-class="\'colt\' + col.index" ng-input="COL_FIELD" ng-blur="updateEntity(col, row, cellValue)" ng-model=\'cellValue\'/>';a.gridCenter={data:"uip_center",multiSelect:!1,enableCellSelection:!0,enableCellEditOnFocus:!0,enableRowSelection:!0,enablePinning:!0,enableSorting:!0,columnDefs:[{field:"CHK",displayName:"chk",width:50,cellTemplate:h,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"status",displayName:"CRUD",width:50,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"link",displayName:"link",width:80,cellTemplate:"<div><button ng-click=\"goTo('/regions/', row)\">to region</button></div>"},{field:"id",displayName:"id",enableCellEdit:!1},{field:"code",displayName:"code",editableCellTemplate:i},{field:"name",displayName:"name",editableCellTemplate:i},{field:"chief",displayName:"chief",editableCellTemplate:i},{field:"address",displayName:"address",editableCellTemplate:i},{field:"phone",displayName:"phone",editableCellTemplate:i}],selectedItems:[],afterSelectionChange:function(b){a.newRegion=b.entity}},g.init(a,d,e,f,"gridCenter")}]),angular.module("sheepgridApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.goTo=function(c,d){var e=c;"/"==c||(d?e+=d.entity.id:a.uip_center[0]&&(e+=a.uip_center[0].id)),b.path(e)}}]),angular.module("sheepgridApp").directive("commbutton",["$compile",function(a){var b=function(a,b,c){var d='<button id="'+a+b+'" class="btn btn-primary" type="button" ng-click="'+a+"Data";return d+=c?"("+c+')"':'()"',d+=">"+a+"</button>"},c=function(c,d,e){d.html(b(e.type,e.data,e.dataset)).show(),a(d.contents())(c)};return{restrict:"E",link:c,replace:!0}}]),angular.module("sheepgridApp").directive("ngBlur",function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.ngBlur)})}}),angular.module("sheepgridApp").service("CommongridService",["socket",function(a){var b=null,c=null,d=null;this.init=function(e,f,g,h,i,j){function k(a){var d={};a&&(d=a),h.get(d,function(a){for(var d=0;d<a[c].length;d++)a[c][d].status="R";e[b]=a[c]})}b=e[i].data,c=b+"s",d=j,e.updateEntity=function(a,c,d){var f=e[b][c.rowIndex],g=e[b][c.rowIndex].status;g&&"I"==g||f[a.colDef.field]!=d&&(e[b][c.rowIndex].status="U"),c.entity[a.field]=d},k(d),e.$on("ngGridEventData",function(){e[i].selectRow&&(e[i].selectRow(0,!0),$(".ngViewport").focus())}),a.on("inserted",function(a){$("#content_log").text(a),e[b].unshift(a[b]),e.retrieveData()}),e.$watch(b,function(){console.log("------------------")}),a.on("updated",function(a){$("#content_log").text(a),l(a.id,function(b){e.setData2(b,a)})}),e.setData2=function(a,c){f(function(){c.status="R",e[b][a]=c},1e3)},a.on("deleted",function(a){$("#content_log").text(a),l(a,function(a){e[b].splice(a,1)}),e.newregion={},e.retrieveData()}),e.retrieveData=function(b){d&&(b=d),k(b),0==g.socketLogined&&(g.socketLogined=!0,a.emit("centers","centers"))},e.insertData=function(){var a=e[i].columnDefs,c=m(a);d&&(c=n(d,c)),c.status="I",e[b].unshift(c);var g=function(){e[i].selectRow(0,!0)};f(g,500)},e.deleteData=function(){for(var a=e[i].selectedItems[0].id,c=0;c<e[b].length;c++)e[b][c].id==a&&("I"==e[b][c].status?e[b].splice(c,1):e[b][c].status="D")},e.initData=function(){for(var a=e[i].selectedItems[0].id,c=0;c<e[b].length;c++)if(e[b][c].id==a){for(var d=0;d<Object.keys(e[b][c]).length;d++)e[b][c][Object.keys(e[b][c])[d]]=null;break}},e.saveData=function(){for(var c=e[b],d=0;d<c.length;d++){var f=c[d].status,i=d;delete c[d].status;var j={};"I"==f?(j[b]=c[d],"spring"==g.server&&(j=c[d]),h.save(j,function(c){e[b][0].id=c[b].id,a.emit("insert",e[b][0])})):"U"==f?(j[b]=c[d],j.id=c[d].id,"spring"==g.server&&(j=j[b]),h.update(j,function(c){e[b][i]=c[b],a.emit("update",e[b][i])})):"D"==f&&h.delete({id:c[d].id},function(){a.emit("delete",e[b][i].id),e[b].splice(i,1)}),e[b][d].status="R"}};var l=function(a,c){for(var d=0;d<e[b].length;d++)if(e[b][d].id==a+""){c(d);break}},m=function(a){for(var b=angular.copy(a),c={},d=0;d<b.length;d++)b[d].field&&"link"!=b[d].field&&"CHK"!=b[d].field&&(c[b[d].field]=null);return c},n=function(a,b){for(var c=0;c<Object.keys(a).length;c++)b[Object.keys(a)[c]]=a[Object.keys(a)[c]];return b}}}]),angular.module("sheepgridApp").factory("CenterService",["$resource","config",function(a,b){return a(b.url+"/uip_centers/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("sheepgridApp").controller("RegionsCtrl",["$scope","$location","$routeParams","$timeout","config","RegionService","CommongridService",function(a,b,c,d,e,f,g){a.$location=b,a.cellValue;var h='<div class="ngSelectionCell"><input tabindex="-1" class="ngSelectionCheckbox" type="checkbox" ng-checked="row.selected" /></div>',i='<input style="width: 90%" step="any" type="string" ng-class="\'colt\' + col.index" ng-input="COL_FIELD" ng-blur="updateEntity(col, row, cellValue)" ng-model=\'cellValue\'/>';a.gridRegion={data:"uip_region",multiSelect:!1,enableCellSelection:!0,enableCellEditOnFocus:!0,enableRowSelection:!0,enablePinning:!0,enableSorting:!0,columnDefs:[{field:"CHK",displayName:"chk",width:50,cellTemplate:h,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"status",displayName:"CRUD",width:50,sortable:!1,pinned:!1,enableCellEdit:!1},{field:"uip_center_id",displayName:"uip_center_id",enableCellEdit:!1},{field:"id",displayName:"id",enableCellEdit:!1},{field:"code",displayName:"code",editableCellTemplate:i},{field:"region_code",displayName:"region_code",editableCellTemplate:i},{field:"name",displayName:"name",editableCellTemplate:i},{field:"chief",displayName:"chief",editableCellTemplate:i},{field:"address",displayName:"address",editableCellTemplate:i}],selectedItems:[],afterSelectionChange:function(b){a.newRegion=b.entity}};var j={uip_center_id:c.id};g.init(a,d,e,f,"gridRegion",j),a.goHomeData=function(){var a="/centers";b.path(a)}}]),angular.module("sheepgridApp").factory("RegionService",["$resource","config",function(a,b){return a(b.url+"/uip_regions/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("sheepgridApp").factory("socket",["$rootScope","config",function(a,b){var c=io.connect(b.socketUrl);return c.on("connect",function(){console.log("Client has connected to the server!")}),{on:function(b,d){c.on(b,function(){var b=arguments;a.$apply(function(){d.apply(c,b)})})},emit:function(b,d,e){c.emit(b,d,function(){var b=arguments;a.$apply(function(){e&&e.apply(c,b)})})}}}]),angular.module("sheepgridApp").filter("agoText",function(){return function(a){return moment.lang("en"),moment(a).fromNow()}}),angular.module("sheepgridApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);